Kafka æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„ã€åŸºäºæ—¥å¿—çš„æ¶ˆæ¯ç³»ç»Ÿã€‚æ‰€è°“â€œæŒä¹…åŒ–â€ï¼Œå°±æ˜¯ Kafka ä¼šå°†ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯é¡ºåºå†™å…¥ç£ç›˜ä¸Šçš„æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œè¿™æ ·å³ä½¿ Kafka æœåŠ¡å™¨é‡å¯ï¼Œæ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚

## ğŸ—‚ï¸ ä¸€ã€æ—¥å¿—æ–‡ä»¶çš„ç‰©ç†ç»“æ„

å‡è®¾æˆ‘ä»¬æœ‰ä¸ªTopic  message-topic åˆ†åŒºä¸º2

Kafka ä¼šåœ¨ç£ç›˜å½¢æˆä»¥ä¸‹ç›®å½•ç»“æ„çš„æ–‡ä»¶
```bash
/tmp/kafka-logs/
â”œâ”€â”€ message-topic-0/
â”‚   â”œâ”€â”€ 00000000000000000000.log         âœ… æ¶ˆæ¯æ•°æ®æ–‡ä»¶ï¼ˆLog Segmentï¼‰
â”‚   â”œâ”€â”€ 00000000000000000000.index       ğŸ” åç§»é‡ç´¢å¼•
â”‚   â”œâ”€â”€ 00000000000000000000.timeindex   ğŸ•’ æ—¶é—´ç´¢å¼•
â”‚   â”œâ”€â”€ 00000000000000001000.log         
â”‚   â”œâ”€â”€ 00000000000000001000.index       
â”‚   â”œâ”€â”€ 00000000000000001000.timeindex   
â”‚   â””â”€â”€ leader-epoch-checkpoint          ğŸ§­ epoch å˜æ›´å†å²
â”œâ”€â”€ message-topic-1/
â”‚   â””â”€â”€ ...

```
## ğŸ“Œ å„ä¸ªæ–‡ä»¶å«ä¹‰
åœ¨Kafkaæ—¥å¿—æ–‡ä»¶ä¸­ï¼Œ*.logã€*.indexã€ *.timeindex éƒ½æ˜¯æˆå¯¹å‡ºç°ï¼Œåœ¨æ¯ä¸ªåˆ†åŒºå†…å­˜åœ¨å¤šä¸ªè¿™æ ·çš„æˆå¯¹æ–‡ä»¶ç»„åˆ
### *.log æ–‡ä»¶
Kafka çœŸæ­£å­˜å‚¨æ¶ˆæ¯çš„æ–‡ä»¶ã€‚
- æ–‡ä»¶åè¡¨ç¤ºè¯¥æ®µçš„ç¬¬ä¸€ä¸ªæ¶ˆæ¯çš„ offset
	ä¾‹å¦‚ï¼š00000000000000000000.log è¡¨ç¤ºä» offset 0 å¼€å§‹ï¼Œ00000000000000001000.log è¡¨ç¤ºä»offset 1000 å¼€å§‹ã€‚
- æ ¼å¼ï¼šæ–‡ä»¶å†…æ˜¯å¤šä¸ªè®°å½•ï¼Œæ¯æ¡è®°å½•åŒ…å« offsetã€timestampã€keyã€value ç­‰ã€‚

#### âœ… ç¤ºä¾‹ç»“æ„
00000000000000000000.log
```log
[offset: 0][timestamp: 1747759812000][key: user0][value: message0]
[offset: 1][timestamp: 1747759813000][key: user0][value: message1]
...
[offset: 50][timestamp: 1747759842000][key: user0][value: message50]
```
00000000000000001000.log
```log
[offset: 1000][timestamp: 1747759912000][key: user0][value: messagexx0]
[offset: 1001][timestamp: 1747759913100][key: user0][value: messagexx1]
...
[offset: 1050][timestamp: 1747759992000][key: user0][value: messagexx50]
```
### *.index æ–‡ä»¶
- ä¿å­˜çš„æ˜¯ offset åˆ° .log æ–‡ä»¶ä¸­ä½ç½®çš„ç‰©ç†åœ°å€ä¹‹é—´çš„æ˜ å°„ã€‚
- å¯ä»¥å¿«é€Ÿå®šä½æŸä¸ª offset çš„æ¶ˆæ¯åœ¨ .log æ–‡ä»¶ä¸­çš„ byte ä½ç½®ã€‚
- Kafka æ¯éš” index.interval.bytesï¼ˆé»˜è®¤4KBï¼‰å°±è®°å½•ä¸€æ¡ç´¢å¼•ã€‚
- å®ƒæ˜¯ä¸€ç§ç¨€ç–ç´¢å¼•ï¼Œä¸ä¼šä¸ºæ¯æ¡æ—¥å¿—éƒ½å»ºç«‹ç´¢å¼•ä¿¡æ¯ã€‚
#### âœ… ç¤ºä¾‹ç»“æ„
00000000000000000000.index 
```index
offset: 0  â†’ position: 0
offset: 10 â†’ position: 4000
offset: 19 â†’ position: 7900
...
offset: 50 â†’ position: 36000
```
å‡è®¾æˆ‘ä»¬è¦æŸ¥æ‰¾offset= 12çš„æ•°æ®ï¼Œæˆ‘ä»¬å…ˆé€šè¿‡00000000000000000000.indexæ‰¾åˆ° offset: 10å¯¹åº”çš„ç‰©ç†åœ°å€ï¼Œç„¶åå†å‘åéå†ï¼Œä¾¿èƒ½å¿«é€Ÿå¾—åˆ°offset= 12çš„æ•°æ®
### *.timeindex æ–‡ä»¶
- ä¿å­˜çš„æ˜¯æ—¶é—´æˆ³åˆ° offset çš„æ˜ å°„ã€‚
- ç”¨äºæŸ¥æ‰¾æŸä¸ªæ—¶é—´ä¹‹åçš„ç¬¬ä¸€æ¡æ¶ˆæ¯ï¼Œæ”¯æŒåŸºäºæ—¶é—´çš„æŸ¥è¯¢ã€‚
- å®ƒä¹Ÿæ˜¯ä¸€ç§ç¨€ç–ç´¢å¼•ï¼Œä¸ä¼šä¸ºæ¯æ¡æ—¥å¿—éƒ½å»ºç«‹ç´¢å¼•ä¿¡æ¯ã€‚
#### âœ… ç¤ºä¾‹ç»“æ„
00000000000000000000.timeindex
```timeindex
timestamp: 1747759812000 â†’ offset: 0
timestamp: 1747759813000 â†’ offset: 8
...
timestamp:1747759842000 â†’ offset: 50
```
#### âœ… å¯¹æ¯”ï¼š*.index vs *.timeindex
| æ–‡ä»¶ç±»å‹         | ä½œç”¨                               | ç´¢å¼•ç±»å‹   | ç´¢å¼•å†…å®¹                 |
| ------------ | -------------------------------- | ------ | -------------------- |
| `*.index`     | æ ¹æ® offset å¿«é€Ÿå®šä½ `.log` ä¸­çš„ byte ä½ç½® | âœ… ç¨€ç–ç´¢å¼• | `offset â†’ position`  |
| `*.timeindex` | æ ¹æ®æ—¶é—´æˆ³å¿«é€Ÿå®šä½ offsetï¼ˆå†å»æŸ¥ `.log`ï¼‰     | âœ… ç¨€ç–ç´¢å¼• | `timestamp â†’ offset` |


### leader-epoch-checkpoint
