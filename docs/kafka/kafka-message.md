结合前面的 Kafka 日志 我们看下Kafka 消息流转过程

## 🧵 1. 生产端消息写入分区的规则

Kafka 生产者发送消息时，Kafka 会根据以下逻辑决定将消息写入哪个分区：

### ✅ 分区选择逻辑

优先级从高到低：

| 条件                     | 分区选择方式                     |
|--------------------------|----------------------------------|
| 显式指定分区  | 使用指定分区                    |
| 设置了 key                | 对 key 做哈希 `% 分区数`         |
| 无 key 且无指定分区       | 轮询选择         |

## 🧵 2. 消费端消费消息规则

Kafka 消费者是按 **分区+offset** 精确读取消息的。

### ✅ 消费者组机制
- 一个 Consumer Group 共享一个消费进度
- 每个 分区最多只能分配给一个组内消费者
- Kafka Broker 会自动进行分区-消费者分配（Rebalance

## 🧠 示例流程（假设有 topic message-topic 分区数为 3）
1. 生产端 发送三条消息，key 分别为：
	- "A" ➜ 分区 1
	- "B" ➜ 分区 2
	- "A" ➜ 分区 1（因为 key 相同）

2. Kafka 按 key 决定分区，写入对应 .log 文件中
3. Consumer Group 中有 2 个消费者：
	- C1 读取分区 0、1
	- C2 读取分区 2